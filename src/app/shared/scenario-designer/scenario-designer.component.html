<div class="scenario-designer-container">
  <canvas #canvas class="scenario-canvas"></canvas>

  <mat-card class="scenario-toolbar">
    <form [formGroup]="form">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Scenario Name</mat-label>
        <input matInput formControlName="name" required />
        @if (form.controls['name'].hasError('required') && form.controls['name'].touched) {
          <mat-error> Name is required </mat-error>
        }
        @if (form.controls['name'].hasError('pattern') && form.controls['name'].touched) {
          <mat-error> Invalid name format </mat-error>
        }
      </mat-form-field>
    </form>

    <div class="toolbar-actions">
      <button mat-stroked-button color="primary" (click)="addEmitter()">Add Emitter</button>
      <button mat-stroked-button color="accent" (click)="addListener()">Add Listener</button>
    </div>

    @if (selectedObject) {
      @if (selectedObject.selection.type === 'listener') {
        <div class="info-panel">
          <h3 class="info-panel-title">Selected listener</h3>
          <p>ID: {{ selectedObject.selection.data.id }}</p>
          <p>
            Position: X: {{ selectedObject.selection.data.position.x.toFixed(2) }}, Y:
            {{ selectedObject.selection.data.position.y.toFixed(2) }}, Z:
            {{ selectedObject.selection.data.position.z.toFixed(2) }}
          </p>
          <button mat-stroked-button color="warn" class="full-width" (click)="deleteSelected()">
            Delete listener
          </button>
        </div>
      } @else if (selectedObject.selection.type === 'emitter') {
        <div class="info-panel">
          <h3 class="info-panel-title">Selected emitter</h3>

          <p class="info-panel-text">ID: {{ selectedObject.selection.data.id }}</p>
          <p class="info-panel-text">
            Position: X: {{ selectedObject.selection.data.position.x.toFixed(2) }}, Y:
            {{ selectedObject.selection.data.position.y.toFixed(2) }}, Z:
            {{ selectedObject.selection.data.position.z.toFixed(2) }}
          </p>

          <mat-form-field appearance="fill" class="full-width file-upload-field">
            <mat-label>Audio File</mat-label>
            <input
              type="file"
              accept="audio/*"
              (change)="onAudioSelected($event, selectedObject.selection.data)"
              hidden
              #fileInput
            />
            <input
              matInput
              [readonly]="true"
              placeholder="No file selected"
              [value]="selectedObject.selection.data.audioFileUri || ''"
            />
            <button mat-icon-button matSuffix (click)="fileInput.click()" type="button">
              <mat-icon>upload_file</mat-icon>
            </button>
          </mat-form-field>

          <button mat-stroked-button color="warn" class="full-width" (click)="deleteSelected()">
            Delete emitter
          </button>
        </div>
      }
    }
  </mat-card>
</div>
