<div class="scenario-designer-container">
  <canvas #canvas class="scenario-canvas"></canvas>

  <mat-card class="scenario-toolbar">
    <form [formGroup]="form">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Scenario Name</mat-label>
        <input matInput formControlName="name" required />
        @if (form.controls['name'].hasError('required') && form.controls['name'].touched) {
          <mat-error> Name is required </mat-error>
        }
        @if (form.controls['name'].hasError('pattern') && form.controls['name'].touched) {
          <mat-error> Invalid name format </mat-error>
        }
      </mat-form-field>
    </form>

    <div class="toolbar-actions">
      <button mat-stroked-button color="primary" (click)="addEmitter()">Add Emitter</button>
      <button mat-stroked-button color="accent" (click)="addListener()">Add Listener</button>
    </div>

    @if (selectedObject) {
      @if (selectedObject.selection.type === 'listener') {
        <div class="info-panel">
          <h3 class="info-panel-title">Selected listener</h3>
          <p>ID: {{ selectedObject.selection.data.id }}</p>
          <p>
            Position: X: {{ selectedObject.selection.data.position.x.toFixed(2) }}, Y:
            {{ selectedObject.selection.data.position.y.toFixed(2) }}, Z:
            {{ selectedObject.selection.data.position.z.toFixed(2) }}
          </p>
          <button mat-stroked-button color="warn" class="full-width" (click)="deleteSelected()">
            Delete listener
          </button>
        </div>
      } @else if (selectedObject.selection.type === 'emitter') {
        <div class="info-panel">
          <h3 class="info-panel-title">Selected emitter</h3>
          <p>ID: {{ selectedObject.selection.data.id }}</p>
          <p>
            Position: X: {{ selectedObject.selection.data.position.x.toFixed(2) }}, Y:
            {{ selectedObject.selection.data.position.y.toFixed(2) }}, Z:
            {{ selectedObject.selection.data.position.z.toFixed(2) }}
          </p>

          <p>Upload or select audio:</p>
          <input
            type="file"
            accept="audio/*"
            (change)="onAudioSelected($event, selectedObject.selection.data)"
          />

          @if (selectedObject.selection.data.audioFileUri) {
            <p>Audio file: {{ selectedObject.selection.data.audioFileUri }}</p>
            <!-- <audio controls [src]="selectedObject.data.audioUrl"></audio> -->
          }
          <button mat-stroked-button color="warn" class="full-width" (click)="deleteSelected()">
            Delete emitter
          </button>
        </div>
      }
    }
  </mat-card>
</div>
